# 해시 조인

## 기본 메커니즘

1. Build 단계 : 작은 쪽 테이블을 읽어 해시테이블을 생성한다.
2. Probe 단계 : 큰 쪽 테이블을 읽어 해시 테이블을 탐색하면서 조인한다.

## 해시 조인이 빠른 이유

+ 소트 머지 조인이 빠른 이유와 같다. 즉, 해시 테이블을 PGA 영역에 할당하기 때문이다. 해시 조인은 래치 획득 과정 없이 PGA에서 빠르게 데이터를 탐색하고 조인한다.

## 대용량 Build Input 처리

1. 파티션 단계
+ 독립적으로 처리할 수 있는 여러 개의 작은 서브 집합으로 분할함으로써 파티션 짝을 생성하는 단계

2. 조인 단계
+ 해시 테이블을 생성하고 나면 반대쪽 파티션 로우를 하나씩 읽으면서 해시 테이블을 탐색한다. 모든 파티션 짝에 대한 처리를 마칠 때까지 이 과정을 반복한다.

## 해시 조인 실행계획 제어

### 세 개 이상 테이블 해시 조인

1. 해시 조인에서 leading 힌트 첫 번째로 지정한 테이블은 무조건 Build Input으로 선택된다.
2. 첫 번째 파라미터로 T1 테이블을 지정했으므로 T2 테이블과 조인할 때는 T1이 Build Input이다.
3. 조인 연결고리를 따라 순방향 또는 역방향으로 leading 힌트에 기술한 후, Build Input으로 선택하고 싶은 테이블을 힌트에 지정해해 주면 된다.

## 조인 메소드 선택 기준

1. 소량 데이터 조인할 때 -> NL 조인
2. 대량 데이터 조인할 때 -> 해시 조인
3. 대량 데이터 조인인데 해시 조인으로 처리할 수 없을 때, 즉 조인 조건식이 등치(=) 조건이 아닐 때 -> 소트 머지 조인

### 수행빈도가 매우 높은 쿼리에 대한 기준

1. NL 조인과 해시 조인 성능이 같으면, NL 조인
2. 해시 조인이 약간 더 빨라도 NL 조인
3. NL 조인보다 해시 조인이 매우 빠른 경우, 해시 조인


### 해시 조인은 세 가지 조건을 만족하는 SQL문에 주로 사용한다

1. 수행 빈도가 낮고
2. 쿼리 수행 시간이 오래 걸리는
3. 대량 데이터 조인할 때
