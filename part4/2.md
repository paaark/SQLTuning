# 소트 머지 조인

## SGA vs PGA

### SGA

1. 공유 메모리 영역인 SGA에 캐시된 데이터는 여러 프로세슷가 공유할 수 있다.
2. 여러 프로세스가 공유할 수 있지만 동시에 액세스할 수 없다.
3. 동시에 액세스하려는 프로세스 간 액세스를 직렬화하기 위한 Lock 메커니즘으로서 래치가 존재한다.
4. 데이터 블록과 인덱스 블록을 캐싱하는 DB 버퍼캐시는 SGA의 가장 핵심적인 구성요소이다.
5. 4번에서 블록을 읽으려면 버퍼 Lock도 얻어야 한다

### PGA

1. 각 오라클 서버 프로세스에 할당된 메모리 영역을 PGA라고 부른다.
2. 프로세스에 종속적인 고유 데이터를 저장하는 용도로 사용한다.
3. 할당받은 PGA 공간이 작아 데이터를 모두 저장할 수 없을 때는 Temp 테이블스페이스를 이용한다.
4. 다른 프로세스와 공유하지 않는 독립적인 메모리 공간이므로 래치 메커니즘이 불필요하다.

## 기본 메커니즘

+ 소트 머지 조인은 2단계로 진행한다.
1. 소트 단계
2. 머지 단계

## 소트 머지 조인이 빠른 이유

1. 소트 머지 조인은 양쪽 테이블로부터 조인 대상 집합을 일괄적으로 읽어 PGA에 저장한 후 조인한다.
2. PGA는 프로세스만을 위한 독립적인 메모리 공간이므로 데이터를 읽을 때 래치 획득 과정이 없다.
3. 그래서 소트 머지 조인이 대량 데이터 조인에 유리하다.

## 소트 머지 조인의 주용도

+ 조인 조건식이 등치(=) 조건이 아닌 대량 데이터 조인
+ 조인 조건식이 아예 없는 조인

## 소트머지 조인 특징 요약

1. 조인을 위해 실시간으로 인덱스를 생성하는 것과 다름 없다.
2. NL 조인은 조인 컬럼에 대한 인덱스 유무에 크게 영향을 크게 받지만, 소트 머지 조인은 영향을 받지 않는다.
3. 조인 컬럼에 인덱스가 없는 상황에서 두 테이블을 각각 읽어 조인 대상 집합을 줄일 수 있을 때 아주 유리하다.
4. 스캔 위주의 액세스 방식을 사용한다는 점도 중요한 특징이다.
